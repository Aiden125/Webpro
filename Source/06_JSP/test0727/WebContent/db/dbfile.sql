--
DROP TABLE MONEY;
DROP TABLE MEMBER;
DROP SEQUENCE MEMBER_SQ;
DROP TABLE MEMBER_LEVEL;




-- 멤버 관련 테이블
CREATE TABLE MEMBER_LEVEL( -- 멤버 등급
    GRADE CHAR(1) PRIMARY KEY,
    LEVEL_NAME VARCHAR2(10)
);
CREATE SEQUENCE MEMBER_SQ -- 멤버 시퀀스
    START WITH 1001 MAXVALUE 99999 NOCYCLE NOCACHE;
    
CREATE TABLE MEMBER( -- 멤버 테이블
    CUSTNO NUMBER(5) PRIMARY KEY NOT NULL,
    CUSTNAME VARCHAR2(20),
    PHONE VARCHAR2(20),
    ADDRESS VARCHAR2(60),
    JOINDATE DATE DEFAULT SYSDATE,
    GRADE CHAR(1) REFERENCES MEMBER_LEVEL(GRADE),
    CITY CHAR(2)
);

INSERT INTO MEMBER_LEVEL
    VALUES('A', 'VIP');
INSERT INTO MEMBER_LEVEL
    VALUES('B', '일반');
INSERT INTO MEMBER_LEVEL
    VALUES('C', '직원');
INSERT INTO MEMBER(CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY)
    VALUES(MEMBER_SQ.NEXTVAL, '홍길동', '010-1111-2222', '서울 동대문구', '20220702', 'A', '01');
INSERT INTO MEMBER(CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY)
    VALUES(MEMBER_SQ.NEXTVAL, '신길동', '010-1111-3333', '서울 강남구', '20220601', 'B', '01');
INSERT INTO MEMBER(CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY)
    VALUES(MEMBER_SQ.NEXTVAL, '김길동', '010-1111-4444', '경기도 안양시', '20220501', 'B', '30');
INSERT INTO MEMBER(CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY)
    VALUES(MEMBER_SQ.NEXTVAL, '유길동', '010-1111-5555', '경기도 의정부시', '20220703', 'A', '30');
INSERT INTO MEMBER(CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY)
    VALUES(MEMBER_SQ.NEXTVAL, '정길동', '010-1111-6666', '서울시 용산구', '20220703', 'B', '60');
    
SELECT * FROM MEMBER;



-- 매출 관련 테이블
DROP TABLE MONEY;

CREATE TABLE MONEY(
    SALENO NUMBER(6) PRIMARY KEY NOT NULL, -- 판매번호
    CUSTNO NUMBER(4) REFERENCES MEMBER(CUSTNO) NOT NULL, -- 회원번호
    COST NUMBER(8), -- 단가
    AMOUNT NUMBER(4), -- 수량
    PRICE NUMBER(8), -- 가격
    PCODE VARCHAR2(4), -- 상품코드
    SDATE DATE -- 판매일자
);

INSERT INTO MONEY
    VALUES(202201, 1001, 100, 20, 2000, 'A01', '20220701');
INSERT INTO MONEY
    VALUES(202202, 1001, 150, 20, 3000, 'A02', '20220701');
INSERT INTO MONEY
    VALUES(202203, 1002, 200, 10, 2000, 'A03', '20220701');
INSERT INTO MONEY
    VALUES(202204, 1003, 100, 5, 500, 'A01', '20220701');
INSERT INTO MONEY
    VALUES(202205, 1004, 100, 9, 900, 'A01', '20220702');
INSERT INTO MONEY
    VALUES(202206, 1003, 150, 6, 900, 'A02', '20220703');
INSERT INTO MONEY
    VALUES(202207, 1001, 200, 2, 400, 'A03', '20220704');
    
SELECT * FROM MONEY;





-- Dao에 들어갈 부분

-- 1. 회원등록
INSERT INTO MEMBER(CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY)
    VALUES(MEMBER_SQ.NEXTVAL, '첫회원', '010-1111-1234', '서울 강남구', '20220702', 'c', 60);
    
-- 2. 회원 번호로 DTO정보 가져오기
SELECT * FROM MEMBER WHERE CUSTNO=1001;

-- 3. 회원 수정하기
UPDATE MEMBER SET CUSTNAME='수정이름',
                PHONE='1234',
                ADDRESS='1234',
                CITY='60'
        WHERE CUSTNO='1005';

-- 4. 회원 목록 조회하기
SELECT * FROM MEMBER;

-- 5. 회원 매출 조회하기
SELECT SUM(PRICE) SUMSAL FROM MONEY GROUP BY CUSTNO;

SELECT M.CUSTNO, M.CUSTNAME, LEVEL_NAME, SUMPRICE
    FROM MEMBER M, MEMBER_LEVEL L, (SELECT CUSTNO, SUM(PRICE) SUMPRICE FROM MONEY GROUP BY CUSTNO) MO
    WHERE M.GRADE=L.GRADE AND M.CUSTNO=MO.CUSTNO
    ORDER BY CUSTNO;

-- 6. 제품 매출 조회
SELECT PCODE, SUM(PRICE) SUMPRICE FROM MONEY GROUP BY PCODE;

COMMIT;

SELECT * FROM MEMBER;
SELECT * FROM MONEY;


SELECT MAX(CUSTNO) FROM MEMBER;





